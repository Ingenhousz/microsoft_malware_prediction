from util import *
from feature_engineering import engineer_feature


# %% read in data
def main(debug=True):

    train, test, y_train, train_ids, test_ids, m = engineer_feature(debug)

    for type in ['gbdt', 'dart', 'goss', 'rf']:
        if type in ['goss', 'dart', 'rf']:
            continue

        with timer('build lgbm model'):
            lgb_train_result, lgb_test_result, score = k_fold_lgbm(train, test, y_train, train_ids, test_ids,
                                                                   m, debug, type)

        with timer('generate submission files'):
            print(type, score)
            data = [lgb_train_result, lgb_test_result]
            save_to_pickle(data, 'input/meta_lgbm_' + type + '.pkl')
            if not debug:
                save_submission(lgb_test_result, score, type)


if __name__ == '__main__':
    main(debug=True)
